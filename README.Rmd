---
title: "attempt1"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

options(repos=structure(c(CRAN="http://cran.utstat.utoronto.ca/")))

install.packages("ggplot2")
install.packages("cvequality")
install.packages("data.table")
install.packages("dplyr")
install.packages("gridExtra")
install.packages("tidyverse")
install.packages("knitr")
library(knitr)
library(ggplot2)
library(cvequality)
library(data.table)

library(dplyr)
library(gridExtra)
library(tidyverse)
```

This is the principle plot that will be used to summarize data in this meta-analysis, in cases where raw data is available . This plot shows intraspecific variations, as well as the interspecific or overall variation (shown in black).
```{r,echo=FALSE}
library(ggplot2)
setwd("C:/Users/User/Documents/Grade - Year 3/eeb397/csvs")
data1A <- read.csv("1A.csv")
names(data1A)[1]<-paste("species") 

p4 <- ggplot(data=data1A)+geom_density(aes(time,colour=species),adjust=3) + geom_density(aes(time),size=2,adjust=3)
p4

```
The R script cvequality was used to do analysis of equality of variances. It was done both to analyze equality of all variances to each other (one test statistic) 

```{r, echo=FALSE}
species_list <- unique(data1A$species)
SD_vector <-vector(mode='list',length=length(unique(data1A$species)))
mean_vector <-vector(mode='list',length=length(unique(data1A$species)))
n_vector <-vector(mode='list',length=length(unique(data1A$species)))
x_vector<-as.vector(data1A$time)
grouping_vector<-as.vector(data1A$species)
i=1

#make a vectors for SD, mean, and n of each species group (to calculate one against all variances)
for (i in 1:(length(unique(data1A$species))))
     {
        #vector with standard deviation values for each species
        tmp<-subset(data1A,species==species_list[[i]])
        
        SD_vector[[i]] <-sd(tmp$time)
     
}

for (i in 1:(length(unique(data1A$species))))
{
  #vector with mean values for each species
  tmp<-subset(data1A,species==species_list[[i]])
  mean_vector[[i]] <-mean(tmp$time)
  
}

for (i in 1:(length(unique(data1A$species))))
{
  #vector with n-values for each group. i.e. how many values in each species group
  tmp<-subset(data1A,species==species_list[[i]])
  n_vector[[i]] <-length(tmp$time)
  
}


#SD and mean of ALL values in dataframe (sample population)
SD_total <- sd(data1A$time, na.rm=TRUE)
mean_total <-mean(data1A$time)
n_total <-length(data1A$time)


#initialize temporary vectors for loop
n_tmp <-vector(mode='numeric',length=2)
s_tmp <-vector(mode='numeric',length=2)
x_tmp <-vector(mode='numeric',length=2)

n_tmp[[2]] <- n_total
s_tmp[[2]] <-SD_total
x_tmp[[2]] <-mean_total
one.v.all <-vector(mode='list',length=length(unique(data1A$species)))


           
```

```{r} 
{
  n_tmp[[1]] <- n_vector[[i]]
  s_tmp[[1]] <- SD_vector[[i]]
  x_tmp[[1]] <- mean_vector[[i]]
  
  one.v.all[[i]] <- asymptotic_test2(2, n = n_tmp,s = s_tmp, x = x_tmp,1)
}
one.v.all

```
as well as comparing the variance of each individual group to overall variance (one.v.all function)

```{r}
result = asymptotic_test(x_vector, grouping_vector, 1)
result
```
Results: Test statistics, p-values, whether the p-value is greater than 0.05(non significant) and whether the variance is greater than total variance, for each group. So we are looking for number that are FALSE-TRUE, TRUE-(anything), and this number tells us how many groups have variance greater than or equal to total variance. In this example, 25/32 (78%) of groups have variance greater than or equal to total. (NB: equality of variance was tested using cvequality to find SIGNIFICANT deviation from equality, versus absolute deviation)

```{r, echo=FALSE}
{
  n_tmp[[1]] <- n_vector[[i]]
  s_tmp[[1]] <- SD_vector[[i]]
  x_tmp[[1]] <- mean_vector[[i]]
  
  one.v.all[[i]] <- asymptotic_test2(2, n = n_tmp,s = s_tmp, x = x_tmp,1)
}
one.v.all


one.v.all <- unlist(one.v.all)

test_statistics <- vector(mode='numeric',length=length(unique(data1A$species)))
p_values <- vector(mode='numeric',length=length(unique(data1A$species)))

i=1

for  (i in 1:(length(unique(data1A$species))))
{
test_statistics[[i]] <- one.v.all[[(i+(i-1))]]
p_values[[i]] <- one.v.all[[(i+i)]]

}

test_statistics
p_values

cv_results <-data.frame(test_statistics,p_values,p_over_five,SD_greater)         
cv_results  

```
